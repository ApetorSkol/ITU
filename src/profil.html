<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>Document</title>
</head>

<body  onload="checkProfile();downloadMojePobocky();">

    <div id="top">
        <div class="popup" id="popup">
            <script>
                function logout(){
                    localStorage.removeItem("flag");
                    var tlacidlo = document.getElementById("btn");
                    tlacidlo.innerHTML = "Prihlásiť sa";
                }
                function change(){
                    var user_name = document.form.meno.value;
                    var user_surname = document.form.priezvisko.value;
                    var user_email = document.form.email.value;
                    var user_number = document.form.telcislo.value;
                    var udaje = new Object();
                    udaje.meno = user_name;
                    udaje.priezvisko = user_surname;
                    udaje.email = user_email;
                    udaje.phoneNumbers = user_number;
                    console.log(udaje);
                    var udaje_json= JSON.stringify(udaje);
                    checkProfile(udaje, true);
                }
            </script>
            <button type="button" id="x_btn" onclick=closePopup()> X </button>
            <h2>Zmeniť údaje</h2>
            <form class="login_form" action="home.html" method="post" name="form" onsubmit="saveEmailAddress(); return validated();">
                <div class="font">Meno</div>
                <input autocomplete="off" type="text" name="meno">
                <div class="font">Priezvisko</div>
                <input name="priezvisko">
                <div class="font">email</div>
                <input name="email">
                <div class="font">Telefónne číslo</div>
                <input name="telcislo">
            </form>
            <form action="profil.html">
                <button type="button" onclick=change()>Uložiť</button>
            </form>
        </div>
        <section id="bar">
            <h1 id="title" >
                <a href="index.html">Bambus</a> <!-- plus nejaka ikonka  -->
            </h1>
            <div class="container">
                <button type="submit" id="btn" class = "btn" onclick="logout()">
                    Odhlásiť sa
                </button>
                <div class="popup" id="popup">
                    <h2>Boli ste odhlásený</h2>
                    <form action="index.html">
                        <button type="submit" onclick=closePopup()>Pokračovať</button>
                    </form>
                </div>
            </div>
        </section>

        <section id="menu">
            <ul>
                <li><a href="index.html">Domov</a></li>
                <li>
                    <a href="sport.html">Šport</a>
                    <ul class="dropdown">
                        <li><a href="">Zimné športy</a></li>
                        <li><a href="">Letné športy</a></li>
                        <li><a href="">Vodné športy</a></li>
                    </ul>
                </li>
                <li>
                    <a href="beauty.html">Krása</a>
                    <ul class="dropdown">
                        <li><a href="">Holičstvá</li>
                        <li><a href="">Starostlivosť o nechty</a></li>
                        <li><a href="">Solaria</a></li>
                    </ul>
                </li>
                <li>
                    <a href="regeneration.html">Regenerácia</a>
                    <ul class="dropdown">
                        <li><a href="regeneration.html#wellness">Wellness</a></li>
                        <li><a href="regeneration.html#massage">Masáže</a></li>
                        <li><a href="regeneration.html#sauna">Sauny</a></li>
                    </ul>
                </li>
                <li>
                    <a href="profil.html" class="profil_btn">Profil</a>
                </li>
            </ul>
        </section>

    </div>
    <div id="mid">
        <section id="right_side">
            <div class="">
                <h1 class="">Údaje</h1>
                <div class="">
                    
                    <div class="card-body">
                        <div class="row">
                            <div >
                                <h3>Full Name</h3>
                            </div>
                            <div id="Meno">

                            </div>
                        </div>

                        <div class="row">
                            <div >
                                <h3>Email</h3>
                            </div>
                            <div id="email">

                            </div>
                        </div>

                        <div class="row">
                            <div >
                                <h3>Phone</h3>
                            </div>
                            <div id="tel_cislo">

                            </div>
                        </div>
                        <div class="Rezervacie">
                            <h1 class="Rezervacie-title">Rezervacie</h1>
                            <hr>
                            <div class="card-body">
                                <div class="row">

                                    <h3 id="first_res">

                                    </h3>
                                    <div id="first_info">

                                    </div>
                                    <h3 id="second_res">

                                    </h3>
                                    <div id="second_info">

                                    </div>
                                    <h3 id="third_res">

                                    </h3>
                                    <div id="third_info">

                                    </div>
                                    <h3 id="fourth_res">

                                    </h3>
                                    <div id="fourth_info">

                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="pobocky">
                            <h1 class="Rezervacie-title">Podniky</h1>
                            <div id="moje_pobocky"></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <section id="left_side">
            <div class="row">
                <div class="card text-center sidebar">
                    <div class="card-body">
                        <img src="Pictures/image.jpg" class="rounded-circle" width="250">
                        <div class="nastavenia">
                            <button type="button" class="profilove_tlac" onclick="openPopup()">Upraviť profil</button>         
                            <hr>              
                            <button class="profilove_tlac">Upraviť rezervácie</Button>
                            <hr>
                            <button class="profilove_tlac">Registrovať pobočku</Button>
                            <hr>
                            <button class="profilove_tlac">Podpora</Button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        
        <div class = "cont">
            <div class="main">
                
                
            </div>
        </div>

    </div>
    

    <div id="bottom">
        <!-- nejaky list kontaktov-->
        <h2 style="margin: 5px">Kontaktujte nas</h2>
        <p style="margin: 5px">CZ tel. číslo: +420 111 111 111</p>
        <p style="margin: 5px">SK tel. číslo: +421 222 222 222</p>
        <p style="margin: 5px"> email: info@bambus.cz</p>
        <p style="margin: 5px">adresa: Božetěchova 1/2, 612 00 Brno-Královo Pole</p>
    </div>

<script>

let popup = document.getElementById("popup");
function openPopup(){
    popup.classList.add("open-popup");
    bottom.classList.add("blur_background");

}
function closePopup(){
    popup.classList.remove("open-popup");
    bottom.classList.remove("blur_background");
    bottom.classList.remove("blur_background");
    var tlacidlo = document.getElementById("btn");
    tlacidlo.innerHTML = "Odhlásiť sa";
}

let add_popup = document.getElementById("add_popup");
function addopenPopup(){
    add_popup.classList.add("open-popup");
}
function addclosePopup(){
    add_popup.classList.remove("open-popup");
    
}

function checkProfile(udaje, changed){  
    var uzivatel = localStorage.getItem('flag');
    var xhttp = new XMLHttpRequest();
    var xhttp2 = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
            
            var uzivatelia = JSON.parse(xhttp.responseText);
            
            console.log(uzivatelia);
            for(let i = 0; i < uzivatelia["rezervacie"].length; i++){
                var reserv = JSON.stringify(uzivatelia["rezervacie"][i]["nazov-title"]);
                var inform = JSON.stringify(uzivatelia["rezervacie"][i]["adresa"]) + "\n" +JSON.stringify(uzivatelia["rezervacie"][i]["datum"]);
                reservation = reserv.replaceAll('"', '');
                information = inform.replaceAll('"', '');
                if (i == 0){
                    var res = document.getElementById("first_res");
                    var info = document.getElementById("first_info");
                    
                    res.innerHTML = reservation;
                    info.innerHTML = information;
                }
                if (i == 1){
                    var res = document.getElementById("second_res");
                    var info = document.getElementById("second_info");
                    
                    res.innerHTML = reservation;
                    info.innerHTML = information;
                }
                if (i == 2){
                    var res = document.getElementById("third_res");
                    var info = document.getElementById("third_info");
                    
                    res.innerHTML = reservation;
                    info.innerHTML = information;
                }
                if (i == 3){
                    var res = document.getElementById("fourth_res");
                    var info = document.getElementById("fourth_info");
                    
                    res.innerHTML = reservation;
                    info.innerHTML = information;
                }


            }
            if(changed == true){
                uzivatelia = udaje;
            }
            var meno_priezvisko = document.getElementById("Meno");
            meno_priezvisko.innerHTML = uzivatelia["meno"] + " " +uzivatelia["priezvisko"];

            var meno_priezvisko = document.getElementById("email");
            meno_priezvisko.innerHTML = uzivatelia["email"];

            var meno_priezvisko = document.getElementById("tel_cislo");
            meno_priezvisko.innerHTML = uzivatelia["phoneNumbers"];



             var final_uzivatelia = JSON.stringify(uzivatelia);
            xhttp2.open("POST", "https://itucko-5mig.onrender.com/zmena_udajov", true);
            xhttp2.send(final_uzivatelia);
        }
    };
    xhttp.open("POST", "https://itucko-5mig.onrender.com/prihlasenie", true);
    xhttp.send(uzivatel);

    


}

</script>

<script>
    

    function createElements(obj) {
                                
        const mainDiv = document.createElement('div');
        mainDiv.classList.add('video-preview');
        const img = document.createElement('img');
        img.classList.add('thumbnail');
        img.src='Pictures/massage.jpeg';
        const title = document.createElement('h2');
        title.classList.add('blog-title');
        title.innerHTML = obj['title'];
        const text = document.createElement('p');
        text.classList.add('blog-text');
        text.innerHTML = obj['text'];
        const adrs = document.createElement('p');
        adrs.classList.add('blog-text');
        adrs.innerHTML = obj['adress'];
        const buttonn = document.createElement('button');
        buttonn.type='submit';
        buttonn.setAttribute("onclick", "deletePobocku("+"'"+obj['title']+"'"+")");
        var t = document.createTextNode("Odstrániť");
        buttonn.appendChild(t);
        mainDiv.appendChild(img);
        mainDiv.appendChild(title);
        mainDiv.appendChild(text);
        mainDiv.appendChild(adrs);
        mainDiv.appendChild(buttonn);
        try{
            document.getElementById("moje_pobocky").appendChild(mainDiv);
        } catch{}
        
    }

    function downloadMojePobocky() {
        var xhttp = new XMLHttpRequest();
        xhttp.open("POST", "https://itucko-5mig.onrender.com/pobocky_user", true);
        xhttp.onreadystatechange = function() {
            if (xhttp.readyState == 4 && xhttp.status == 200) {
                getMojePobocky(xhttp);
            }
        };

        var uzivatel = localStorage.getItem('flag');
        //var d = JSON.parse(uzivatel);
        //var results = JSON.stringify(uzivatel);
        xhttp.send(uzivatel);
    }
    
    function getMojePobocky(request) {
        var lastId = -1;
        var pobocky = JSON.parse(request.responseText);

        for (var i in pobocky) {
           if (i > lastId) {
            createElements(pobocky[i]);
               lastId = i;
            }
        }
    }
    function deletePobocku(data){
        var xhttp = new XMLHttpRequest();
        xhttp.open("POST", "https://itucko-5mig.onrender.com/vymaz_pobocku", true);
        xhttp.send(data);
        xhttp.onreadystatechange = function() {
            if (xhttp.readyState == 4 && xhttp.status == 200) {
                const div = document.querySelector('#moje_pobocky');
                removeAllChildNodes(div);
                downloadMojePobocky();
            }
        };

        //var uzivatel = localStorage.getItem('flag');
        //var d = JSON.parse(uzivatel);
        //var results = JSON.stringify(uzivatel);
        
    }
    function removeAllChildNodes(parent) {
        while (parent.firstChild) {
            parent.removeChild(parent.firstChild);
        }
    }
    
</script>
</body>
</html>
